const A=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,w=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,O=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function $(r,n){if(r==="__proto__"||r==="constructor"&&n&&typeof n=="object"&&"prototype"in n){E(r);return}return n}function E(r){console.warn(`[destr] Dropping "${r}" key to prevent prototype pollution.`)}function P(r,n={}){if(typeof r!="string")return r;const e=r.trim();if(r[0]==='"'&&r.endsWith('"')&&!r.includes("\\"))return e.slice(1,-1);if(e.length<=9){const t=e.toLowerCase();if(t==="true")return!0;if(t==="false")return!1;if(t==="undefined")return;if(t==="null")return null;if(t==="nan")return Number.NaN;if(t==="infinity")return Number.POSITIVE_INFINITY;if(t==="-infinity")return Number.NEGATIVE_INFINITY}if(!O.test(r)){if(n.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(A.test(r)||w.test(r)){if(n.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,$)}return JSON.parse(r)}catch(t){if(n.strict)throw t;return r}}function h(r,n){if(r==null)return;let e=r;for(let t=0;t<n.length;t++){if(e==null||e[n[t]]==null)return;e=e[n[t]]}return e}function a(r,n,e){if(e.length===0)return n;const t=e[0];return e.length>1&&(n=a(typeof r!="object"||r===null||!Object.prototype.hasOwnProperty.call(r,t)?Number.isInteger(Number(e[1]))?[]:{}:r[t],n,Array.prototype.slice.call(e,1))),Number.isInteger(Number(t))&&Array.isArray(r)?r.slice()[t]:Object.assign({},r,{[t]:n})}function N(r,n){if(r==null||n.length===0)return r;if(n.length===1){if(r==null)return r;if(Number.isInteger(n[0])&&Array.isArray(r))return Array.prototype.slice.call(r,0).splice(n[0],1);const e={};for(const t in r)e[t]=r[t];return delete e[n[0]],e}if(r[n[0]]==null){if(Number.isInteger(n[0])&&Array.isArray(r))return Array.prototype.concat.call([],r);const e={};for(const t in r)e[t]=r[t];return e}return a(r,N(r[n[0]],Array.prototype.slice.call(n,1)),[n[0]])}function I(r,n){return n.map(e=>e.split(".")).map(e=>[e,h(r,e)]).filter(e=>!!e[1]).reduce((e,t)=>a(e,t[1],t[0]),{})}function S(r,n){return n.map(e=>e.split(".")).reduce((e,t)=>N(e,t),r)}function g(r,{storage:n,serializer:e,key:t,debug:s,pick:c,omit:o,beforeHydrate:i,afterHydrate:u},f,d=!0){try{d&&(i==null||i(f));const l=n.getItem(t);if(l){const p=e.deserialize(l),y=c?I(p,c):p,_=o?S(y,o):y;r.$patch(_)}d&&(u==null||u(f))}catch(l){s&&console.error("[pinia-plugin-persistedstate]",l)}}function m(r,{storage:n,serializer:e,key:t,debug:s,pick:c,omit:o}){try{const i=c?I(r,c):r,u=o?S(i,o):i,f=e.serialize(u);n.setItem(t,f)}catch(i){s&&console.error("[pinia-plugin-persistedstate]",i)}}function z(r,n){const{pinia:e,store:t,options:{persist:s}}=r;if(!s)return;if(!(t.$id in e.state.value)){const i=e._s.get(t.$id.replace("__hot:",""));i&&Promise.resolve().then(()=>i.$persist());return}const o=(Array.isArray(s)?s:s===!0?[{}]:[s]).map(n);t.$hydrate=({runHooks:i=!0}={})=>{o.forEach(u=>{g(t,u,r,i)})},t.$persist=()=>{o.forEach(i=>{m(t.$state,i)})},o.forEach(i=>{g(t,i,r),t.$subscribe((u,f)=>m(f,i),{detached:!0})})}function F(r={}){return function(n){z(n,e=>({key:(r.key?r.key:t=>t)(e.key??n.store.$id),debug:e.debug??r.debug??!1,serializer:e.serializer??r.serializer??{serialize:t=>JSON.stringify(t),deserialize:t=>P(t)},storage:e.storage??r.storage??window.localStorage,beforeHydrate:e.beforeHydrate,afterHydrate:e.afterHydrate,pick:e.pick,omit:e.omit}))}}export{F as createPersistedState};
